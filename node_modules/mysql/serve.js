var express = require('express')
var mysql = require('mysql'); //call express
var app = express();
//var db = mysql('resta',['crud']);

var bodyParser = require('body-parser');

app.use(express.static(__dirname + "/public"));
app.use(bodyParser.json());

//var connection = mysql.createConnection({
var pool = mysql.createPool({
	host: 'localhost',
	user: 'Rojan',
	password: 'use123',
	database: 'resta',
	port: 3307
});
var insertRecord = 'INSERT INTO crud(user_ID,First_Name,Last_Name,Email,Contact No) VALUE(?,?,?,?,?)';
var readTable = 'SELECT * FROM crud';
var updateRecord = 'UPDATE employee SET user_ID = ? WHERE First_Name=? WHERE Last_Name=? WHERE Email=? WHERE Contact No=?'; 
var deleteRecord = 'DELETE FROM crud WHERE First_Name=? WHERE Last_Name=? WHERE Email=? WHERE Contact No=?';
var dropTable = 'DROP table crud';
// connection.connect(function(error){ //callback function
// 	if(!!error) {
// 		console.log('Error');
// 	} else {
// 		console.log('Connected');
// 	}
// });
pool.getConnection(function(err, connection){ 
	connection.query(insertRecord, function(err,res){
    if(err) throw err;
    else {
        console.log('A new employee has been added.');
    }
   });

	connection.query(readTable, function(err, rows){
    if(err) throw err;
    else {
        console.log(rows);
    }
  });
 
  //Update a record.
  connection.query(updateRecord, function(err, res){
    if(err) throw err;
    else {
        console.log('Increased the salary ');
    }
  });
 
  //Read table.
  connection.query(readTable, function(err, rows){
    if(err) throw err;
    else {
        console.log(rows);
    }
  });
 
  //Delete a record.
  connection.query(deleteRecord, function(err, res){
    if(err) throw err;
    else {
        console.log('An employee is removed.');
    }
  });
 
  //Drop a table.
  connection.query(dropTable, function(err, res){
    if(err) throw err;
    else {
        console.log('The employee table is removed.');
    }
  });
 
  connection.release();//release the connection
});
// app.get('/', function(req, resp){
// 	console.log("I received request")

// 	db.crud.query(function(err, docs){
// 		console.log(docs);
// 		resp.json(docs);
// 	});
// });
// app.post('/contactlist', function(req,resp){
// 	console.log(req.body);//print data it receives to cmd prompt
// 	db.crud.insert(req.body,function(err, doc){
// 		resp.json(doc);
// 	})
// });

// app.delete('/contactlist/:id', function(req, resp){
// 	var id = req.params.id;
// 	console.log(id);
// 	db.crud.remove({_id: mysql.ObjectId(id)}, function(err, doc){
// 		resp.json(doc);
// 	});
// });

// app.get('/contactlist/:id', function(req, resp){
// 	var id = req.params.id;//get value of id from url
// 	console.log(id);
// 	db.crud.findOne({_id: mysql.ObjectId(id)}, function(err, doc){
// 		resp.json(doc);
// 	});
// });
// app.put('/contactlist/:id', function(req, resp){
// 	var id = req.params.id;
// 	console.log(req.body.First_Name);
// 	db.crud.findAndModify({query: {_id:mysql.ObjectId(id)},
// 		update: {$set: {user_ID: req.body.user_ID, First_Name: req.body.First_Name, Last_Name: req.body.Last_Name, Email: req.body.Email, ContactNo: req.body.ContactNo}},
// 		new: true}, function(err, doc) {
// 			res.json(doc);
// 	});
// });
	// connection.query("SELECT * FROM crud", function(error, rows, fields){
	// 	//callback
	// 	if(!!error){
	// 		console.log('Error in the query');
	// 	} else {
	// 		console.log('Successful query');
	// 		console.log(rows[0].First_Name);
	// 		resp.send(rows[0].First_Name);
	// 		//console.log(fields);
	// 	}
	// });


app.listen(3009);
console.log("Server running on port 3009");